time="2025-04-11T15:55:15-04:00" level=info msg="Connecting to Timeplus at localhost:8464 (workspace: default)"
time="2025-04-11T15:55:15-04:00" level=info msg="Connecting to Timeplus native protocol at localhost:8464"
time="2025-04-11T15:55:15-04:00" level=info msg="Alert Gateway: Successfully connected to Timeplus."
time="2025-04-11T15:55:15-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:55:15-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:55:15-04:00" level=info msg="Resuming rule: Low Temperature Alert"
time="2025-04-11T15:55:15-04:00" level=info msg="Starting rule Low Temperature Alert with ID 17d725ae-5754-4e0f-881c-90582d3e5a31"
time="2025-04-11T15:55:15-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:55:15-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:55:15-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:55:15-04:00" level=info msg="Checking if results stream rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results exists"
time="2025-04-11T15:55:15-04:00" level=info msg="Creating/recreating results stream rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results"
time="2025-04-11T15:55:15-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results': code: 630, message: Cannot drop 'default.rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results (7e8eeff4-cd5a-48dd-81a5-795ab61d1f9b)', because some views depend on it: default.rule_17d725ae_5754_4e0f_881c_90582d3e5a31_view (25b9f6c6-24bd-45bb-a846-9ab36a1662ec), default.rule_17d725ae_5754_4e0f_881c_90582d3e5a31_acks_view (c5c6b33d-2886-431d-ab2d-79f51bf8ef69)"
time="2025-04-11T15:55:15-04:00" level=info msg="Results stream rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results successfully created/verified"
time="2025-04-11T15:55:15-04:00" level=info msg="View rule_17d725ae_5754_4e0f_881c_90582d3e5a31_view already exists, dropping it"
time="2025-04-11T15:55:15-04:00" level=info msg="Using modified query for view rule_17d725ae_5754_4e0f_881c_90582d3e5a31_view: \n\t\tSELECT \n\t\t\t'17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:55:15-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:55:15-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_17d725ae_5754_4e0f_881c_90582d3e5a31_view` INTO `rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results` AS \n\t\tSELECT \n\t\t\t'17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:55:15-04:00" level=info msg="Successfully created materialized view rule_17d725ae_5754_4e0f_881c_90582d3e5a31_view into rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results"
time="2025-04-11T15:55:15-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_17d725ae_5754_4e0f_881c_90582d3e5a31_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results\n"
time="2025-04-11T15:55:15-04:00" level=info msg="Attempt 1 to create alert acks view: rule_17d725ae-5754-4e0f-881c-90582d3e5a31_acks_view"
time="2025-04-11T15:55:15-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:16-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:18-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:21-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:55:23-04:00" level=info msg="Attempt 2 to create alert acks view: rule_17d725ae-5754-4e0f-881c-90582d3e5a31_acks_view"
time="2025-04-11T15:55:23-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:24-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:26-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:29-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:55:31-04:00" level=info msg="Attempt 3 to create alert acks view: rule_17d725ae-5754-4e0f-881c-90582d3e5a31_acks_view"
time="2025-04-11T15:55:31-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:32-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:34-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:55:37-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:55:39-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '17d725ae-5754-4e0f-881c-90582d3e5a31' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_17d725ae_5754_4e0f_881c_90582d3e5a31_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:55:39-04:00" level=info msg="Successfully started rule 17d725ae-5754-4e0f-881c-90582d3e5a31"
time="2025-04-11T15:55:39-04:00" level=info msg="Resuming rule: High Temperature Alert"
time="2025-04-11T15:55:39-04:00" level=info msg="Starting rule High Temperature Alert with ID 1dd75389-2978-45f6-a91e-31f50463e54f"
time="2025-04-11T15:55:39-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:55:39-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:55:39-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:55:39-04:00" level=info msg="Checking if results stream rule_1dd75389_2978_45f6_a91e_31f50463e54f_results exists"
time="2025-04-11T15:55:39-04:00" level=info msg="Creating/recreating results stream rule_1dd75389_2978_45f6_a91e_31f50463e54f_results"
time="2025-04-11T15:55:39-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_1dd75389_2978_45f6_a91e_31f50463e54f_results': code: 630, message: Cannot drop 'default.rule_1dd75389_2978_45f6_a91e_31f50463e54f_results (bea59a84-3a5c-4ab2-b0cd-ae854932ec17)', because some views depend on it: default.rule_1dd75389_2978_45f6_a91e_31f50463e54f_view (bfa8a615-48f3-4545-9b90-55b0fe7b227d)"
time="2025-04-11T15:55:39-04:00" level=info msg="Results stream rule_1dd75389_2978_45f6_a91e_31f50463e54f_results successfully created/verified"
time="2025-04-11T15:55:39-04:00" level=info msg="View rule_1dd75389_2978_45f6_a91e_31f50463e54f_view already exists, dropping it"
time="2025-04-11T15:55:39-04:00" level=info msg="Using modified query for view rule_1dd75389_2978_45f6_a91e_31f50463e54f_view: \n\t\tSELECT \n\t\t\t'1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:55:39-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:55:39-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_1dd75389_2978_45f6_a91e_31f50463e54f_view` INTO `rule_1dd75389_2978_45f6_a91e_31f50463e54f_results` AS \n\t\tSELECT \n\t\t\t'1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:55:39-04:00" level=info msg="Successfully created materialized view rule_1dd75389_2978_45f6_a91e_31f50463e54f_view into rule_1dd75389_2978_45f6_a91e_31f50463e54f_results"
time="2025-04-11T15:55:39-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_1dd75389_2978_45f6_a91e_31f50463e54f_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_1dd75389_2978_45f6_a91e_31f50463e54f_results\n"
time="2025-04-11T15:55:39-04:00" level=info msg="Attempt 1 to create alert acks view: rule_1dd75389-2978-45f6-a91e-31f50463e54f_acks_view"
time="2025-04-11T15:55:39-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:40-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:42-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:45-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']"
time="2025-04-11T15:55:47-04:00" level=info msg="Attempt 2 to create alert acks view: rule_1dd75389-2978-45f6-a91e-31f50463e54f_acks_view"
time="2025-04-11T15:55:47-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:48-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:50-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:53-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']"
time="2025-04-11T15:55:55-04:00" level=info msg="Attempt 3 to create alert acks view: rule_1dd75389-2978-45f6-a91e-31f50463e54f_acks_view"
time="2025-04-11T15:55:55-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:56-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:55:58-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']. Retrying..."
time="2025-04-11T15:56:01-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']"
time="2025-04-11T15:56:03-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' 'device_id' while processing query: 'SELECT\n  '1dd75389-2978-45f6-a91e-31f50463e54f' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_1dd75389_2978_45f6_a91e_31f50463e54f_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['rule_id']"
time="2025-04-11T15:56:03-04:00" level=info msg="Successfully started rule 1dd75389-2978-45f6-a91e-31f50463e54f"
time="2025-04-11T15:56:03-04:00" level=info msg="Resuming rule: High Temperature Alert"
time="2025-04-11T15:56:03-04:00" level=info msg="Starting rule High Temperature Alert with ID 21d02b1a-3e1c-4778-8fec-413c28c4cdc0"
time="2025-04-11T15:56:03-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:56:03-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:56:03-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:56:03-04:00" level=info msg="Checking if results stream rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results exists"
time="2025-04-11T15:56:03-04:00" level=info msg="Creating/recreating results stream rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results"
time="2025-04-11T15:56:03-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results': code: 630, message: Cannot drop 'default.rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results (241ec69a-0c18-4f01-97c7-90d148e3f462)', because some views depend on it: default.rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_view (ca2f3ffd-8ad9-438c-9a89-34afb447427c), default.rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_acks_view (f99afc06-fc69-4c6a-bd65-638b28fe4d72)"
time="2025-04-11T15:56:03-04:00" level=info msg="Results stream rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results successfully created/verified"
time="2025-04-11T15:56:03-04:00" level=info msg="View rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_view already exists, dropping it"
time="2025-04-11T15:56:04-04:00" level=info msg="Using modified query for view rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_view: \n\t\tSELECT \n\t\t\t'21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:56:04-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:56:04-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_view` INTO `rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results` AS \n\t\tSELECT \n\t\t\t'21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:56:04-04:00" level=info msg="Successfully created materialized view rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_view into rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results"
time="2025-04-11T15:56:04-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results\n"
time="2025-04-11T15:56:04-04:00" level=info msg="Attempt 1 to create alert acks view: rule_21d02b1a-3e1c-4778-8fec-413c28c4cdc0_acks_view"
time="2025-04-11T15:56:04-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:05-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:07-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:10-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:12-04:00" level=info msg="Attempt 2 to create alert acks view: rule_21d02b1a-3e1c-4778-8fec-413c28c4cdc0_acks_view"
time="2025-04-11T15:56:12-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:13-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:15-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:18-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:20-04:00" level=info msg="Attempt 3 to create alert acks view: rule_21d02b1a-3e1c-4778-8fec-413c28c4cdc0_acks_view"
time="2025-04-11T15:56:20-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:21-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:23-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:26-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:28-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '21d02b1a-3e1c-4778-8fec-413c28c4cdc0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_21d02b1a_3e1c_4778_8fec_413c28c4cdc0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:28-04:00" level=info msg="Successfully started rule 21d02b1a-3e1c-4778-8fec-413c28c4cdc0"
time="2025-04-11T15:56:28-04:00" level=info msg="Resuming rule: Device 1 Temperature Alert"
time="2025-04-11T15:56:28-04:00" level=info msg="Starting rule Device 1 Temperature Alert with ID 33d91eef-688b-4544-9086-a48b94ca6368"
time="2025-04-11T15:56:28-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:56:28-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:56:28-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:56:28-04:00" level=info msg="Checking if results stream rule_33d91eef_688b_4544_9086_a48b94ca6368_results exists"
time="2025-04-11T15:56:28-04:00" level=info msg="Creating/recreating results stream rule_33d91eef_688b_4544_9086_a48b94ca6368_results"
time="2025-04-11T15:56:28-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_33d91eef_688b_4544_9086_a48b94ca6368_results': code: 630, message: Cannot drop 'default.rule_33d91eef_688b_4544_9086_a48b94ca6368_results (e674d9e9-aef9-4f1d-baee-9c765aa65927)', because some views depend on it: default.rule_33d91eef_688b_4544_9086_a48b94ca6368_acks_view (6e79e973-9097-4ebf-810c-b683eb3bd9b8), default.rule_33d91eef_688b_4544_9086_a48b94ca6368_view (1d8b3821-d54c-4d75-b171-c14f63ffe00c)"
time="2025-04-11T15:56:28-04:00" level=info msg="Results stream rule_33d91eef_688b_4544_9086_a48b94ca6368_results successfully created/verified"
time="2025-04-11T15:56:28-04:00" level=info msg="View rule_33d91eef_688b_4544_9086_a48b94ca6368_view already exists, dropping it"
time="2025-04-11T15:56:28-04:00" level=info msg="Using modified query for view rule_33d91eef_688b_4544_9086_a48b94ca6368_view: \n\t\tSELECT \n\t\t\t'33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:56:28-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:56:28-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_33d91eef_688b_4544_9086_a48b94ca6368_view` INTO `rule_33d91eef_688b_4544_9086_a48b94ca6368_results` AS \n\t\tSELECT \n\t\t\t'33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:56:28-04:00" level=info msg="Successfully created materialized view rule_33d91eef_688b_4544_9086_a48b94ca6368_view into rule_33d91eef_688b_4544_9086_a48b94ca6368_results"
time="2025-04-11T15:56:28-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_33d91eef_688b_4544_9086_a48b94ca6368_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_33d91eef_688b_4544_9086_a48b94ca6368_results\n"
time="2025-04-11T15:56:28-04:00" level=info msg="Attempt 1 to create alert acks view: rule_33d91eef-688b-4544-9086-a48b94ca6368_acks_view"
time="2025-04-11T15:56:28-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:29-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:31-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:34-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:36-04:00" level=info msg="Attempt 2 to create alert acks view: rule_33d91eef-688b-4544-9086-a48b94ca6368_acks_view"
time="2025-04-11T15:56:36-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:37-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:39-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:42-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:44-04:00" level=info msg="Attempt 3 to create alert acks view: rule_33d91eef-688b-4544-9086-a48b94ca6368_acks_view"
time="2025-04-11T15:56:44-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:45-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:47-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:50-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:52-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '33d91eef-688b-4544-9086-a48b94ca6368' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_33d91eef_688b_4544_9086_a48b94ca6368_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:56:52-04:00" level=info msg="Successfully started rule 33d91eef-688b-4544-9086-a48b94ca6368"
time="2025-04-11T15:56:52-04:00" level=info msg="Resuming rule: Device 1 Temperature Alert"
time="2025-04-11T15:56:52-04:00" level=info msg="Starting rule Device 1 Temperature Alert with ID 4c1e1075-2181-4737-9f18-39c9d3ac236c"
time="2025-04-11T15:56:52-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:56:52-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:56:52-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:56:52-04:00" level=info msg="Checking if results stream rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results exists"
time="2025-04-11T15:56:52-04:00" level=info msg="Creating/recreating results stream rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results"
time="2025-04-11T15:56:52-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results': code: 630, message: Cannot drop 'default.rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results (539d6959-1db4-4e7f-bff7-a351c535c9dd)', because some views depend on it: default.rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_view (a318b2fc-2204-4144-bf14-ca08b8b892bf)"
time="2025-04-11T15:56:52-04:00" level=info msg="Results stream rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results successfully created/verified"
time="2025-04-11T15:56:52-04:00" level=info msg="View rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_view already exists, dropping it"
time="2025-04-11T15:56:52-04:00" level=info msg="Using modified query for view rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_view: \n\t\tSELECT \n\t\t\t'4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:56:52-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:56:52-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_view` INTO `rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results` AS \n\t\tSELECT \n\t\t\t'4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:56:52-04:00" level=info msg="Successfully created materialized view rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_view into rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results"
time="2025-04-11T15:56:52-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results\n"
time="2025-04-11T15:56:52-04:00" level=info msg="Attempt 1 to create alert acks view: rule_4c1e1075-2181-4737-9f18-39c9d3ac236c_acks_view"
time="2025-04-11T15:56:52-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:53-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:55-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:56:58-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:00-04:00" level=info msg="Attempt 2 to create alert acks view: rule_4c1e1075-2181-4737-9f18-39c9d3ac236c_acks_view"
time="2025-04-11T15:57:00-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:01-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:03-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:06-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:08-04:00" level=info msg="Attempt 3 to create alert acks view: rule_4c1e1075-2181-4737-9f18-39c9d3ac236c_acks_view"
time="2025-04-11T15:57:08-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:09-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:11-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:14-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:16-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '4c1e1075-2181-4737-9f18-39c9d3ac236c' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_4c1e1075_2181_4737_9f18_39c9d3ac236c_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:16-04:00" level=info msg="Successfully started rule 4c1e1075-2181-4737-9f18-39c9d3ac236c"
time="2025-04-11T15:57:16-04:00" level=info msg="Resuming rule: High Temperature Alert"
time="2025-04-11T15:57:16-04:00" level=info msg="Starting rule High Temperature Alert with ID 5189f840-ea18-49f3-a8f5-645655f72a28"
time="2025-04-11T15:57:16-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:57:16-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:57:16-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:57:16-04:00" level=info msg="Checking if results stream rule_5189f840_ea18_49f3_a8f5_645655f72a28_results exists"
time="2025-04-11T15:57:16-04:00" level=info msg="Creating/recreating results stream rule_5189f840_ea18_49f3_a8f5_645655f72a28_results"
time="2025-04-11T15:57:16-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_5189f840_ea18_49f3_a8f5_645655f72a28_results': code: 630, message: Cannot drop 'default.rule_5189f840_ea18_49f3_a8f5_645655f72a28_results (5ee98dd4-6f03-4207-9023-3e7a947b8ab1)', because some views depend on it: default.rule_5189f840_ea18_49f3_a8f5_645655f72a28_view (df560d35-209d-4d3d-a7d3-8134808dc6a5)"
time="2025-04-11T15:57:16-04:00" level=info msg="Results stream rule_5189f840_ea18_49f3_a8f5_645655f72a28_results successfully created/verified"
time="2025-04-11T15:57:16-04:00" level=info msg="View rule_5189f840_ea18_49f3_a8f5_645655f72a28_view already exists, dropping it"
time="2025-04-11T15:57:16-04:00" level=info msg="Using modified query for view rule_5189f840_ea18_49f3_a8f5_645655f72a28_view: \n\t\tSELECT \n\t\t\t'5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:57:16-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:57:16-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_5189f840_ea18_49f3_a8f5_645655f72a28_view` INTO `rule_5189f840_ea18_49f3_a8f5_645655f72a28_results` AS \n\t\tSELECT \n\t\t\t'5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, \n\t\t\t'High Temperature Alert' AS rule_name, \n\t\t\t'critical' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature > 30)\n\t"
time="2025-04-11T15:57:16-04:00" level=info msg="Successfully created materialized view rule_5189f840_ea18_49f3_a8f5_645655f72a28_view into rule_5189f840_ea18_49f3_a8f5_645655f72a28_results"
time="2025-04-11T15:57:16-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_5189f840_ea18_49f3_a8f5_645655f72a28_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_5189f840_ea18_49f3_a8f5_645655f72a28_results\n"
time="2025-04-11T15:57:16-04:00" level=info msg="Attempt 1 to create alert acks view: rule_5189f840-ea18-49f3-a8f5-645655f72a28_acks_view"
time="2025-04-11T15:57:16-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:17-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:19-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:22-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:24-04:00" level=info msg="Attempt 2 to create alert acks view: rule_5189f840-ea18-49f3-a8f5-645655f72a28_acks_view"
time="2025-04-11T15:57:24-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:25-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:27-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:30-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:32-04:00" level=info msg="Attempt 3 to create alert acks view: rule_5189f840-ea18-49f3-a8f5-645655f72a28_acks_view"
time="2025-04-11T15:57:32-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:33-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:35-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:38-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:40-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '5189f840-ea18-49f3-a8f5-645655f72a28' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_5189f840_ea18_49f3_a8f5_645655f72a28_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:40-04:00" level=info msg="Successfully started rule 5189f840-ea18-49f3-a8f5-645655f72a28"
time="2025-04-11T15:57:40-04:00" level=info msg="Resuming rule: Low Temperature Alert"
time="2025-04-11T15:57:40-04:00" level=info msg="Starting rule Low Temperature Alert with ID 8362d6f0-2c67-43c7-af27-a07229026cd2"
time="2025-04-11T15:57:40-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:57:40-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:57:40-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:57:40-04:00" level=info msg="Checking if results stream rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results exists"
time="2025-04-11T15:57:40-04:00" level=info msg="Creating/recreating results stream rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results"
time="2025-04-11T15:57:40-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results': code: 630, message: Cannot drop 'default.rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results (05219caf-b9c7-495a-8a62-016fb558d106)', because some views depend on it: default.rule_8362d6f0_2c67_43c7_af27_a07229026cd2_acks_view (37366ea0-a266-4ba7-8813-1624737cec3d), default.rule_8362d6f0_2c67_43c7_af27_a07229026cd2_view (422f0c6e-d72e-4471-8933-20af7cb8d779)"
time="2025-04-11T15:57:40-04:00" level=info msg="Results stream rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results successfully created/verified"
time="2025-04-11T15:57:40-04:00" level=info msg="View rule_8362d6f0_2c67_43c7_af27_a07229026cd2_view already exists, dropping it"
time="2025-04-11T15:57:40-04:00" level=info msg="Using modified query for view rule_8362d6f0_2c67_43c7_af27_a07229026cd2_view: \n\t\tSELECT \n\t\t\t'8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:57:40-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:57:40-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_8362d6f0_2c67_43c7_af27_a07229026cd2_view` INTO `rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results` AS \n\t\tSELECT \n\t\t\t'8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:57:41-04:00" level=info msg="Successfully created materialized view rule_8362d6f0_2c67_43c7_af27_a07229026cd2_view into rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results"
time="2025-04-11T15:57:41-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_8362d6f0_2c67_43c7_af27_a07229026cd2_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results\n"
time="2025-04-11T15:57:41-04:00" level=info msg="Attempt 1 to create alert acks view: rule_8362d6f0-2c67-43c7-af27-a07229026cd2_acks_view"
time="2025-04-11T15:57:41-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:42-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:44-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:47-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:49-04:00" level=info msg="Attempt 2 to create alert acks view: rule_8362d6f0-2c67-43c7-af27-a07229026cd2_acks_view"
time="2025-04-11T15:57:49-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:50-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:52-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:55-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:57:57-04:00" level=info msg="Attempt 3 to create alert acks view: rule_8362d6f0-2c67-43c7-af27-a07229026cd2_acks_view"
time="2025-04-11T15:57:57-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:57:58-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:00-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:03-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:05-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '8362d6f0-2c67-43c7-af27-a07229026cd2' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_8362d6f0_2c67_43c7_af27_a07229026cd2_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:05-04:00" level=info msg="Successfully started rule 8362d6f0-2c67-43c7-af27-a07229026cd2"
time="2025-04-11T15:58:05-04:00" level=info msg="Resuming rule: Low Temperature Alert"
time="2025-04-11T15:58:05-04:00" level=info msg="Starting rule Low Temperature Alert with ID 89c39129-e71b-4c3a-a2b9-f2c28b43ca92"
time="2025-04-11T15:58:05-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:58:05-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:58:05-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:58:05-04:00" level=info msg="Checking if results stream rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results exists"
time="2025-04-11T15:58:05-04:00" level=info msg="Creating/recreating results stream rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results"
time="2025-04-11T15:58:05-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results': code: 630, message: Cannot drop 'default.rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results (3596ea2a-d5d1-40bc-b881-410407a99870)', because some views depend on it: default.rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_view (23aa0206-4882-4416-91a4-bae509bdb827)"
time="2025-04-11T15:58:05-04:00" level=info msg="Results stream rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results successfully created/verified"
time="2025-04-11T15:58:05-04:00" level=info msg="View rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_view already exists, dropping it"
time="2025-04-11T15:58:05-04:00" level=info msg="Using modified query for view rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_view: \n\t\tSELECT \n\t\t\t'89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:58:05-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:58:05-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_view` INTO `rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results` AS \n\t\tSELECT \n\t\t\t'89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, \n\t\t\t'Low Temperature Alert' AS rule_name, \n\t\t\t'info' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE temperature < 19)\n\t"
time="2025-04-11T15:58:05-04:00" level=info msg="Successfully created materialized view rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_view into rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results"
time="2025-04-11T15:58:05-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results\n"
time="2025-04-11T15:58:05-04:00" level=info msg="Attempt 1 to create alert acks view: rule_89c39129-e71b-4c3a-a2b9-f2c28b43ca92_acks_view"
time="2025-04-11T15:58:05-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:06-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:08-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:11-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:13-04:00" level=info msg="Attempt 2 to create alert acks view: rule_89c39129-e71b-4c3a-a2b9-f2c28b43ca92_acks_view"
time="2025-04-11T15:58:13-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:14-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:16-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:19-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:21-04:00" level=info msg="Attempt 3 to create alert acks view: rule_89c39129-e71b-4c3a-a2b9-f2c28b43ca92_acks_view"
time="2025-04-11T15:58:21-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:22-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:24-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:27-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:29-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  '89c39129-e71b-4c3a-a2b9-f2c28b43ca92' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_89c39129_e71b_4c3a_a2b9_f2c28b43ca92_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:29-04:00" level=info msg="Successfully started rule 89c39129-e71b-4c3a-a2b9-f2c28b43ca92"
time="2025-04-11T15:58:29-04:00" level=info msg="Resuming rule: Device 1 Temperature Alert"
time="2025-04-11T15:58:29-04:00" level=info msg="Starting rule Device 1 Temperature Alert with ID d1f39a44-8563-490c-8f30-10ed5baf9ef0"
time="2025-04-11T15:58:29-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:58:29-04:00" level=info msg="Setting up mutable alert acknowledgments stream"
time="2025-04-11T15:58:29-04:00" level=info msg="Mutable alert acknowledgments stream already exists"
time="2025-04-11T15:58:29-04:00" level=info msg="Checking if results stream rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results exists"
time="2025-04-11T15:58:29-04:00" level=info msg="Creating/recreating results stream rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results"
time="2025-04-11T15:58:29-04:00" level=warning msg="Error while trying to delete result stream (may not exist): failed to delete stream 'rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results': code: 630, message: Cannot drop 'default.rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results (54ada939-b6f3-4757-a137-441ecc927dd1)', because some views depend on it: default.rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_acks_view (8f12040b-2b7a-4f9d-9e58-6c45ed6981a3), default.rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_view (cce57931-f27c-4dc8-b2f7-f9cd94371dea)"
time="2025-04-11T15:58:29-04:00" level=info msg="Results stream rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results successfully created/verified"
time="2025-04-11T15:58:29-04:00" level=info msg="View rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_view already exists, dropping it"
time="2025-04-11T15:58:29-04:00" level=info msg="Using modified query for view rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_view: \n\t\tSELECT \n\t\t\t'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:58:29-04:00" level=info msg="Attempt 1 to create materialized view with query: \n\t\tSELECT \n\t\t\t'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:58:29-04:00" level=info msg="Executing materialized view creation query (with wrapper): CREATE MATERIALIZED VIEW `rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_view` INTO `rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results` AS \n\t\tSELECT \n\t\t\t'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, \n\t\t\t'Device 1 Temperature Alert' AS rule_name, \n\t\t\t'warning' AS severity,\n\t\t\tnow() AS triggered_at,\n\t\t\t*\n\t\tFROM (SELECT * FROM device_temperatures WHERE device_id = 'device_1' AND temperature > 25)\n\t"
time="2025-04-11T15:58:29-04:00" level=info msg="Successfully created materialized view rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_view into rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results"
time="2025-04-11T15:58:29-04:00" level=info msg="Creating alert acks view with query: \nCREATE MATERIALIZED VIEW rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_acks_view INTO tp_alert_acks_mutable AS \nSELECT \n\t'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id,\n\tCASE \n\t\tWHEN hasColumn('entity_id') AND isNotNull(entity_id) THEN entity_id\n\t\tWHEN hasColumn('device_id') AND isNotNull(device_id) THEN device_id\n\t\tWHEN hasColumn('ip') AND isNotNull(ip) THEN ip\n\t\tWHEN hasColumn('host') AND isNotNull(host) THEN host\n\t\tWHEN hasColumn('user_id') AND isNotNull(user_id) THEN user_id \n\t\tWHEN hasColumn('id') AND isNotNull(id) THEN id\n\t\tELSE toString(now64(3)) -- Fallback: use timestamp as unique ID if no identifying field exists\n\tEND AS entity_id,\n\t'active' AS state,\n\tnow() AS created_at,\n\tnow() AS updated_at,\n\t'' AS updated_by,\n\t'' AS comment\nFROM rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results\n"
time="2025-04-11T15:58:29-04:00" level=info msg="Attempt 1 to create alert acks view: rule_d1f39a44-8563-490c-8f30-10ed5baf9ef0_acks_view"
time="2025-04-11T15:58:29-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:30-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:32-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:35-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 1): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:37-04:00" level=info msg="Attempt 2 to create alert acks view: rule_d1f39a44-8563-490c-8f30-10ed5baf9ef0_acks_view"
time="2025-04-11T15:58:37-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:38-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:40-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:43-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 2): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:45-04:00" level=info msg="Attempt 3 to create alert acks view: rule_d1f39a44-8563-490c-8f30-10ed5baf9ef0_acks_view"
time="2025-04-11T15:58:45-04:00" level=warning msg="Query attempt 1 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:46-04:00" level=warning msg="Query attempt 2 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:48-04:00" level=warning msg="Query attempt 3 failed: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']. Retrying..."
time="2025-04-11T15:58:51-04:00" level=warning msg="Failed to create alert acks view, retrying... (attempt 3): failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:53-04:00" level=error msg="Failed to create alert acks view after retries: failed to execute query after retries: code: 47, message: Missing columns: 'id' 'host' 'ip' 'entity_id' 'user_id' while processing query: 'SELECT\n  'd1f39a44-8563-490c-8f30-10ed5baf9ef0' AS rule_id, multi_if(hasColumn('entity_id') AND isNotNull(entity_id), entity_id, hasColumn('device_id') AND isNotNull(device_id), device_id, hasColumn('ip') AND isNotNull(ip), ip, hasColumn('host') AND isNotNull(host), host, hasColumn('user_id') AND isNotNull(user_id), user_id, hasColumn('id') AND isNotNull(id), id, toString(now64(3))) AS entity_id, 'active' AS state, now() AS created_at, now() AS updated_at, '' AS updated_by, '' AS comment\nFROM\n  rule_d1f39a44_8563_490c_8f30_10ed5baf9ef0_results', required columns: 'device_id' 'user_id' 'entity_id' 'ip' 'host' 'id', maybe you meant: ['device_id']"
time="2025-04-11T15:58:53-04:00" level=info msg="Successfully started rule d1f39a44-8563-490c-8f30-10ed5baf9ef0"
time="2025-04-11T15:58:53-04:00" level=info msg="Starting Alert Monitor service"
time="2025-04-11T15:58:53-04:00" level=info msg="Note: This is now using materialized views to write directly to tp_alert_acks_mutable - no polling is performed"
time="2025-04-11T15:58:53-04:00" level=info msg="Alert Monitor successfully connected to Timeplus"
time="2025-04-11T15:58:53-04:00" level=info msg="Alert monitoring service started"
time="2025-04-11T15:58:53-04:00" level=info msg="Starting server on port 8081"

   ____    __
  / __/___/ /  ___
 / _// __/ _ \/ _ \
/___/\__/_//_/\___/ v4.13.3
High performance, minimalist Go web framework
https://echo.labstack.com
____________________________________O/_______
                                    O\
time="2025-04-11T15:58:53-04:00" level=fatal msg="Failed to start server: listen tcp :8081: bind: address already in use"
exit status 1
